<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WriteFlow - AI 영어 작문 교정</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-lg">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-r from-blue-600 to-purple-600 rounded-xl flex items-center justify-center">
                        <span class="text-white font-bold text-xl">W</span>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold gradient-text">WriteFlow</h1>
                        <p class="text-sm text-gray-600" id="header-subtitle">AI 영어 작문 교정</p>
                    </div>
                </div>
                <div class="flex items-center space-x-2 bg-gray-100 rounded-lg p-1">
                    <i data-lucide="globe" class="w-4 h-4 text-gray-500"></i>
                    <button onclick="setLanguage('ko')" id="btn-ko" class="px-3 py-1 rounded-md text-sm font-medium transition-colors bg-white text-blue-600 shadow-sm">한국어</button>
                    <button onclick="setLanguage('zh')" id="btn-zh" class="px-3 py-1 rounded-md text-sm font-medium transition-colors text-gray-600 hover:text-gray-800">中文</button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Title -->
        <div class="text-center mb-12 fade-in">
            <h2 class="text-4xl font-bold text-gray-800 mb-4" id="main-title">영어 작문 AI 교정</h2>
            <p class="text-lg text-gray-600 max-w-2xl mx-auto" id="main-description">
                ChatGPT가 당신의 영어 작문을 교정하고 상세한 피드백을 제공합니다.
            </p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Input Section -->
            <div class="space-y-6">
                <div class="bg-white rounded-2xl shadow-lg p-8 fade-in">
                    <div class="flex items-center space-x-3 mb-6">
                        <i data-lucide="book-open" class="w-6 h-6 text-blue-600"></i>
                        <h3 class="text-xl font-semibold text-gray-800" id="input-title">영어 작문 입력</h3>
                    </div>
                    
                    <textarea
                        id="writing-input"
                        placeholder="여기에 영어로 작문해보세요...

예시:
I think that technology has changed our lives in many ways. First of all, it makes communication easier and faster. We can talk to people all over the world instantly through the internet."
                        class="w-full h-80 p-4 border-2 border-gray-200 rounded-xl resize-none focus:border-blue-500 focus:outline-none transition-colors text-gray-800"
                        oninput="updateWordCount()"
                    ></textarea>
                    
                    <div class="flex items-center justify-between mt-4">
                        <div class="text-sm text-gray-500">
                            <span id="word-count-label">단어 수</span>: <span id="word-count">0</span>
                        </div>
                        <button
                            id="correct-btn"
                            onclick="handleCorrection()"
                            class="flex items-center space-x-2 bg-gradient-to-r from-blue-600 to-purple-600 text-white px-6 py-3 rounded-xl font-medium hover:from-blue-700 hover:to-purple-700 transition-all duration-200 shadow-lg hover:shadow-xl"
                        >
                            <i data-lucide="send" class="w-5 h-5"></i>
                            <span id="correct-btn-text">교정하기</span>
                        </button>
                    </div>
                </div>

                <!-- Error Message -->
                <div id="error-message" class="hidden bg-red-50 border border-red-200 rounded-xl p-4 fade-in">
                    <div class="flex items-center space-x-2">
                        <i data-lucide="alert-circle" class="w-5 h-5 text-red-600"></i>
                        <p class="text-red-700" id="error-text"></p>
                    </div>
                </div>
            </div>

            <!-- Results Section -->
            <div class="space-y-6">
                <!-- Corrected Content -->
                <div id="corrected-section" class="hidden bg-white rounded-2xl shadow-lg p-8 fade-in">
                    <div class="flex items-center space-x-3 mb-6">
                        <i data-lucide="check-circle" class="w-6 h-6 text-green-600"></i>
                        <h3 class="text-xl font-semibold text-gray-800" id="corrected-title">교정된 내용</h3>
                    </div>
                    <div class="bg-gray-50 rounded-xl p-4 border-l-4 border-green-500">
                        <p id="corrected-content" class="text-gray-800 leading-relaxed whitespace-pre-wrap"></p>
                    </div>
                </div>

                <!-- Feedback -->
                <div id="feedback-section" class="hidden bg-white rounded-2xl shadow-lg p-8 fade-in">
                    <div class="flex items-center space-x-3 mb-6">
                        <i data-lucide="star" class="w-6 h-6 text-yellow-600"></i>
                        <h3 class="text-xl font-semibold text-gray-800" id="feedback-title">상세 피드백</h3>
                    </div>

                    <!-- Scores -->
                    <div class="grid grid-cols-2 gap-4 mb-6">
                        <div id="overall-score" class="bg-blue-100 rounded-xl p-4 text-center">
                            <div class="text-2xl font-bold mb-1">
                                <span class="text-blue-600" id="overall-score-value">0</span>
                                <span class="text-gray-600 text-lg">/100</span>
                            </div>
                            <div class="text-sm font-medium text-gray-700" id="overall-score-label">전체 점수</div>
                        </div>
                        <div id="grammar-score" class="bg-blue-100 rounded-xl p-4 text-center">
                            <div class="text-2xl font-bold mb-1">
                                <span class="text-blue-600" id="grammar-score-value">0</span>
                                <span class="text-gray-600 text-lg">/100</span>
                            </div>
                            <div class="text-sm font-medium text-gray-700" id="grammar-score-label">문법 점수</div>
                        </div>
                        <div id="vocabulary-score" class="bg-blue-100 rounded-xl p-4 text-center">
                            <div class="text-2xl font-bold mb-1">
                                <span class="text-blue-600" id="vocabulary-score-value">0</span>
                                <span class="text-gray-600 text-lg">/100</span>
                            </div>
                            <div class="text-sm font-medium text-gray-700" id="vocabulary-score-label">어휘 점수</div>
                        </div>
                        <div id="coherence-score" class="bg-blue-100 rounded-xl p-4 text-center">
                            <div class="text-2xl font-bold mb-1">
                                <span class="text-blue-600" id="coherence-score-value">0</span>
                                <span class="text-gray-600 text-lg">/100</span>
                            </div>
                            <div class="text-sm font-medium text-gray-700" id="coherence-score-label">일관성 점수</div>
                        </div>
                    </div>

                    <!-- Overall Explanation -->
                    <div class="mb-6">
                        <h4 class="font-semibold text-gray-800 mb-3 flex items-center space-x-2">
                            <i data-lucide="lightbulb" class="w-5 h-5 text-yellow-500"></i>
                            <span id="explanation-title">전체 평가</span>
                        </h4>
                        <p id="explanation-text" class="text-gray-700 leading-relaxed bg-yellow-50 p-4 rounded-xl"></p>
                    </div>

                    <!-- Corrections -->
                    <div id="corrections-section" class="mb-6">
                        <h4 class="font-semibold text-gray-800 mb-3" id="corrections-title">교정 사항</h4>
                        <div id="corrections-list" class="space-y-3"></div>
                    </div>

                    <!-- Suggestions -->
                    <div id="suggestions-section">
                        <h4 class="font-semibold text-gray-800 mb-3" id="suggestions-title">개선 제안</h4>
                        <ul id="suggestions-list" class="space-y-2"></ul>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-white border-t border-gray-200 mt-16">
        <div class="container mx-auto px-4 py-8">
            <div class="text-center">
                <div class="flex items-center justify-center space-x-3 mb-4">
                    <div class="w-8 h-8 bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg flex items-center justify-center">
                        <span class="text-white font-bold">W</span>
                    </div>
                    <span class="text-xl font-bold text-gray-800">WriteFlow</span>
                </div>
                <p class="text-gray-600 mb-4">
                    AI-powered English writing correction platform for non-native speakers
                </p>
                <div class="flex items-center justify-center space-x-6 text-sm text-gray-500">
                    <span>Powered by ChatGPT API</span>
                    <span>•</span>
                    <span>Made with ❤️ for English learners</span>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        let currentLanguage = 'ko';
        let isCorrecting = false;

        // Language translations
        const translations = {
            ko: {
                'header-subtitle': 'AI 영어 작문 교정',
                'main-title': '영어 작문 AI 교정',
                'main-description': 'ChatGPT가 당신의 영어 작문을 교정하고 상세한 피드백을 제공합니다.',
                'input-title': '영어 작문 입력',
                'input-placeholder': '여기에 영어로 작문해보세요...\n\n예시:\nI think that technology has changed our lives in many ways. First of all, it makes communication easier and faster. We can talk to people all over the world instantly through the internet.',
                'word-count-label': '단어 수',
                'correct-btn-text': '교정하기',
                'correcting-text': '교정 중...',
                'corrected-title': '교정된 내용',
                'feedback-title': '상세 피드백',
                'overall-score-label': '전체 점수',
                'grammar-score-label': '문법 점수',
                'vocabulary-score-label': '어휘 점수',
                'coherence-score-label': '일관성 점수',
                'explanation-title': '전체 평가',
                'corrections-title': '교정 사항',
                'suggestions-title': '개선 제안',
                'error-empty': '작문 내용을 입력해주세요.',
                'error-server': 'AI 교정 중 오류가 발생했습니다. 다시 시도해주세요.'
            },
            zh: {
                'header-subtitle': 'AI英语写作批改',
                'main-title': '英语写作AI批改',
                'main-description': 'ChatGPT将为您批改英语写作并提供详细反馈。',
                'input-title': '英语写作输入',
                'input-placeholder': '请在这里用英语写作...\n\n示例:\nI think that technology has changed our lives in many ways. First of all, it makes communication easier and faster. We can talk to people all over the world instantly through the internet.',
                'word-count-label': '字数',
                'correct-btn-text': '批改',
                'correcting-text': '批改中...',
                'corrected-title': '批改后的内容',
                'feedback-title': '详细反馈',
                'overall-score-label': '总分',
                'grammar-score-label': '语法分数',
                'vocabulary-score-label': '词汇分数',
                'coherence-score-label': '连贯性分数',
                'explanation-title': '总体评价',
                'corrections-title': '批改事项',
                'suggestions-title': '改进建议',
                'error-empty': '请输入写作内容。',
                'error-server': 'AI批改过程中出现错误，请重试。'
            }
        };

        function setLanguage(lang) {
            currentLanguage = lang;
            
            // Update button states
            document.getElementById('btn-ko').className = lang === 'ko' 
                ? 'px-3 py-1 rounded-md text-sm font-medium transition-colors bg-white text-blue-600 shadow-sm'
                : 'px-3 py-1 rounded-md text-sm font-medium transition-colors text-gray-600 hover:text-gray-800';
            document.getElementById('btn-zh').className = lang === 'zh' 
                ? 'px-3 py-1 rounded-md text-sm font-medium transition-colors bg-white text-blue-600 shadow-sm'
                : 'px-3 py-1 rounded-md text-sm font-medium transition-colors text-gray-600 hover:text-gray-800';

            // Update text content
            const t = translations[lang];
            document.getElementById('header-subtitle').textContent = t['header-subtitle'];
            document.getElementById('main-title').textContent = t['main-title'];
            document.getElementById('main-description').textContent = t['main-description'];
            document.getElementById('input-title').textContent = t['input-title'];
            document.getElementById('writing-input').placeholder = t['input-placeholder'];
            document.getElementById('word-count-label').textContent = t['word-count-label'];
            document.getElementById('correct-btn-text').textContent = isCorrecting ? t['correcting-text'] : t['correct-btn-text'];
            document.getElementById('corrected-title').textContent = t['corrected-title'];
            document.getElementById('feedback-title').textContent = t['feedback-title'];
            document.getElementById('overall-score-label').textContent = t['overall-score-label'];
            document.getElementById('grammar-score-label').textContent = t['grammar-score-label'];
            document.getElementById('vocabulary-score-label').textContent = t['vocabulary-score-label'];
            document.getElementById('coherence-score-label').textContent = t['coherence-score-label'];
            document.getElementById('explanation-title').textContent = t['explanation-title'];
            document.getElementById('corrections-title').textContent = t['corrections-title'];
            document.getElementById('suggestions-title').textContent = t['suggestions-title'];
        }

        function updateWordCount() {
            const content = document.getElementById('writing-input').value;
            const wordCount = content.trim().split(/\s+/).filter(word => word.length > 0).length;
            document.getElementById('word-count').textContent = wordCount;
        }

        function showError(message) {
            document.getElementById('error-text').textContent = message;
            document.getElementById('error-message').classList.remove('hidden');
            setTimeout(() => {
                document.getElementById('error-message').classList.add('hidden');
            }, 5000);
        }

        function hideError() {
            document.getElementById('error-message').classList.add('hidden');
        }

        function setLoading(loading) {
            isCorrecting = loading;
            const btn = document.getElementById('correct-btn');
            const btnText = document.getElementById('correct-btn-text');
            
            if (loading) {
                btn.disabled = true;
                btn.className = btn.className.replace('hover:from-blue-700 hover:to-purple-700', 'opacity-50 cursor-not-allowed');
                btnText.textContent = translations[currentLanguage]['correcting-text'];
                btn.innerHTML = '<i data-lucide="loader-2" class="w-5 h-5 animate-spin"></i><span>' + btnText.textContent + '</span>';
            } else {
                btn.disabled = false;
                btn.className = btn.className.replace('opacity-50 cursor-not-allowed', 'hover:from-blue-700 hover:to-purple-700');
                btnText.textContent = translations[currentLanguage]['correct-btn-text'];
                btn.innerHTML = '<i data-lucide="send" class="w-5 h-5"></i><span>' + btnText.textContent + '</span>';
            }
            lucide.createIcons();
        }

        function getScoreColor(score) {
            if (score >= 90) return 'text-green-600';
            if (score >= 80) return 'text-blue-600';
            if (score >= 70) return 'text-yellow-600';
            return 'text-red-600';
        }

        function getScoreBg(score) {
            if (score >= 90) return 'bg-green-100';
            if (score >= 80) return 'bg-blue-100';
            if (score >= 70) return 'bg-yellow-100';
            return 'bg-red-100';
        }

        async function handleCorrection() {
            const content = document.getElementById('writing-input').value.trim();
            
            if (!content) {
                showError(translations[currentLanguage]['error-empty']);
                return;
            }

            setLoading(true);
            hideError();

            try {
                // Simulate API call with OpenAI
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                // Call our own backend server
                const response = await fetch('/api/correct', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                        'Authorization': `Bearer ${process.env.OPENAI_API_KEY}`
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'gpt-4',
                        messages: [
                            {
                                role: 'system',
                                content: `You are an expert English writing tutor. Your task is to:
1. Correct grammar, spelling, and punctuation errors
2. Suggest better vocabulary and expressions
3. Improve sentence structure and flow
4. Provide detailed feedback in ${currentLanguage === 'ko' ? 'Korean' : 'Chinese'}

Format your response as JSON with the following structure:
{
  "corrected_content": "corrected English text",
  "feedback": {
    "overall_score": 85,
    "grammar_score": 90,
    "vocabulary_score": 80,
    "coherence_score": 85,
    "corrections": [
      {
        "original": "incorrect text",
        "corrected": "corrected text",
        "explanation": "explanation in ${currentLanguage === 'ko' ? 'Korean' : 'Chinese'}"
      }
    ],
    "suggestions": [
      "suggestion 1 in ${currentLanguage === 'ko' ? 'Korean' : 'Chinese'}",
      "suggestion 2 in ${currentLanguage === 'ko' ? 'Korean' : 'Chinese'}"
    ],
    "explanation": "overall feedback in ${currentLanguage === 'ko' ? 'Korean' : 'Chinese'}"
  }
}`
                            },
                            {
                                role: 'user',
                                content: content
                            }
                        ],
                        temperature: 0.3,
                        max_tokens: 2000
                        content: content,
                        nativeLanguage: currentLanguage
                    })
                });

                if (!response.ok) {
                    throw new Error('API request failed');
                }

                const data = await response.json();
                let aiResponse;

                try {
                    aiResponse = JSON.parse(data.choices[0].message.content);
                } catch (parseError) {
                    // Fallback response
                    aiResponse = {
                        corrected_content: content,
                        feedback: {
                            overall_score: 75,
                            grammar_score: 70,
                            vocabulary_score: 75,
                            coherence_score: 80,
                            corrections: [],
                            suggestions: [currentLanguage === 'ko' ? 'AI 응답 파싱 오류가 발생했습니다.' : 'AI响应解析错误'],
                            explanation: currentLanguage === 'ko' ? '죄송합니다. AI 응답을 처리하는 중에 오류가 발생했습니다.' : '抱歉，处理AI响应时出现错误。'
                        }
                    };
                if (!response.ok) {
                    throw new Error(data.error || 'API request failed');
                }
                displayResults(data);

                displayResults(aiResponse);

            } catch (error) {
                console.error('Error:', error);
                showError(translations[currentLanguage]['error-server']);
            } finally {
                setLoading(false);
            }
        }

        function displayResults(data) {
            // Show corrected content
            document.getElementById('corrected-content').textContent = data.corrected_content;
            document.getElementById('corrected-section').classList.remove('hidden');

            // Update scores
            const feedback = data.feedback;
            
            // Update score displays
            document.getElementById('overall-score-value').textContent = feedback.overall_score;
            document.getElementById('grammar-score-value').textContent = feedback.grammar_score;
            document.getElementById('vocabulary-score-value').textContent = feedback.vocabulary_score;
            document.getElementById('coherence-score-value').textContent = feedback.coherence_score;

            // Update score colors
            const scores = [
                { element: 'overall-score', score: feedback.overall_score },
                { element: 'grammar-score', score: feedback.grammar_score },
                { element: 'vocabulary-score', score: feedback.vocabulary_score },
                { element: 'coherence-score', score: feedback.coherence_score }
            ];

            scores.forEach(({ element, score }) => {
                const el = document.getElementById(element);
                el.className = el.className.replace(/bg-\w+-100/, getScoreBg(score));
                const scoreValue = el.querySelector('[id$="-value"]');
                scoreValue.className = scoreValue.className.replace(/text-\w+-600/, getScoreColor(score));
            });

            // Update explanation
            document.getElementById('explanation-text').textContent = feedback.explanation;

            // Update corrections
            const correctionsList = document.getElementById('corrections-list');
            correctionsList.innerHTML = '';
            
            if (feedback.corrections && feedback.corrections.length > 0) {
                document.getElementById('corrections-section').classList.remove('hidden');
                feedback.corrections.forEach(correction => {
                    const correctionDiv = document.createElement('div');
                    correctionDiv.className = 'bg-red-50 border border-red-200 rounded-xl p-4';
                    correctionDiv.innerHTML = `
                        <div class="flex items-start space-x-3 mb-2">
                            <span class="bg-red-100 text-red-700 px-2 py-1 rounded text-sm font-medium">${correction.original}</span>
                            <span class="text-gray-400">→</span>
                            <span class="bg-green-100 text-green-700 px-2 py-1 rounded text-sm font-medium">${correction.corrected}</span>
                        </div>
                        <p class="text-sm text-gray-600">${correction.explanation}</p>
                    `;
                    correctionsList.appendChild(correctionDiv);
                });
            } else {
                document.getElementById('corrections-section').classList.add('hidden');
            }

            // Update suggestions
            const suggestionsList = document.getElementById('suggestions-list');
            suggestionsList.innerHTML = '';
            
            if (feedback.suggestions && feedback.suggestions.length > 0) {
                feedback.suggestions.forEach(suggestion => {
                    const li = document.createElement('li');
                    li.className = 'flex items-start space-x-2 text-gray-700';
                    li.innerHTML = `
                        <span class="text-blue-500 mt-1">•</span>
                        <span>${suggestion}</span>
                    `;
                    suggestionsList.appendChild(li);
                });
            }

            // Show feedback section
            document.getElementById('feedback-section').classList.remove('hidden');
        }

        // Initialize
        setLanguage('ko');
        lucide.createIcons();
    </script>
</body>
</html>

